










<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Image Processing Toolkit</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <div class="container">
    <h1>üß† Image & Video Processing Toolkit</h1>
    <p class="subtitle">An all-in-one visual API for Computer Vision Experiments</p>

    <form id="uploadForm">
      <label class="file-label">
        <input type="file" name="file" accept="image/*" required>
        Choose Main Image
      </label>

      <label class="file-label secondary">
        <input type="file" name="file2" accept="image/*">
        (Optional) Choose Second Image (for Bitwise Ops)
      </label>

      <select name="operation" id="operation" size="10">
        <optgroup label="üß© Module 1: Bitwise Operations">
          <option value="bitwise_and">Bitwise AND</option>
          <option value="bitwise_or">Bitwise OR</option>
          <option value="bitwise_not">Bitwise NOT</option>
          <option value="bitwise_xor">Bitwise XOR</option>
        </optgroup>

        <optgroup label="üé® Module 2: Color Models & Enhancement">
          <option value="bgr_to_luminance_gray">BGR ‚Üí Grayscale (Luminance)</option>
          <option value="apply_colormap_hot">Pseudo Color (HOT)</option>
          <option value="bgr_to_cmy">RGB ‚Üí CMY</option>
          <option value="bgr_to_cmyk">RGB ‚Üí CMYK</option>
          <option value="bgr_to_ycbcr">RGB ‚Üí YCbCr</option>
          <option value="intensity_slice_2">2-Slice Intensity Coding</option>
          <option value="intensity_slice_n">8-Slice Intensity Coding</option>
        </optgroup>

        <optgroup label="üìê Module 3: Geometric Transformations">
          <option value="scale">Scaling</option>
          <option value="rotate">Rotation</option>
          <option value="translate">Translation</option>
          <option value="shear">Shear (X/Y)</option>
          <option value="reflect">Reflection</option>
        </optgroup>

        <optgroup label="‚ö° Module 4: Intensity Transformations">
          <option value="negative_intensity">Negative</option>
          <option value="log_transform">Logarithmic</option>
          <option value="inverse_log">Inverse Log</option>
          <option value="power_law">Power Law (Gamma)</option>
          <option value="contrast_stretch">Contrast Stretching</option>
          <option value="piecewise_linear">Piecewise Linear</option>
        </optgroup>

        <optgroup label="üìä Module 5: Histogram Operations">
          <option value="hist_eq">Histogram Equalization</option>
        </optgroup>

        <optgroup label="üîç Module 6: Smoothing & Filtering">
          <option value="box_filter">Box (Mean) Filter</option>
          <option value="weighted_filter">Weighted Average Filter</option>
          <option value="gaussian_sigma">Gaussian Filter (œÉ)</option>
          <option value="min_filter">Min Filter</option>
          <option value="max_filter">Max Filter</option>
          <option value="median_filter">Median Filter</option>
          <option value="midpoint_filter">Midpoint Filter</option>
        </optgroup>

        <optgroup label="üßÆ Module 7: Mean Variants">
          <option value="arithmetic_mean">Arithmetic Mean</option>
          <option value="geometric_mean">Geometric Mean</option>
          <option value="harmonic_mean">Harmonic Mean</option>
          <option value="contra_harmonic">Contra-Harmonic Mean</option>
          <option value="alpha_trimmed">Alpha-Trimmed Mean</option>
        </optgroup>

        <optgroup label="üí• Module 8: Sharpening & Edge Detection">
          <option value="unsharp_mask">Unsharp Mask</option>
          <option value="high_boost">High Boost Filter</option>
          <option value="prewitt">Prewitt Operator</option>
          <option value="sobel">Sobel Operator</option>
          <option value="laplacian">Laplacian</option>
          <option value="log_of_gaussian">Laplacian of Gaussian (LoG)</option>
          <option value="canny">Canny Edge Detection</option>
        </optgroup>

        <optgroup label="üèÅ Module 9: Feature Detection & Hough">
          <option value="harris">Harris Corner Detection</option>
          <option value="hough_lines">Hough Line Transform</option>
          <option value="hough_circles">Hough Circle Transform</option>
        </optgroup>

        <optgroup label="‚öôÔ∏è Module 10: Morphology & Texture">
          <option value="dilate">Dilation</option>
          <option value="erode">Erosion</option>
          <option value="opening">Opening</option>
          <option value="closing">Closing</option>
          <option value="hit_or_miss">Hit or Miss</option>
          <option value="boundary">Boundary Extraction</option>
          <option value="skeleton">Skeletonization</option>
          <option value="lbp">Local Binary Pattern (LBP)</option>
        </optgroup>

        <optgroup label="üóúÔ∏è Compression & Advanced (NEW)">
          <option value="rle_text">RLE (Run-Length Encoding) ‚Äî text output</option>
          <option value="huffman_encoded_image">Huffman ‚Äî encoded image (visual)</option>
          <option value="dct_block">DCT Block compress (zig-zag keep)</option>
          <option value="quantize_levels">Uniform Quantization (levels)</option>
          <option value="zigzag_dct">Zig-Zag DCT (visualize)</option>
          <option value="color_compress_kmeans">Color Compression (K-Means)</option>
          <option value="shift">Shift / Translate (shift_x, shift_y)</option>
          <option value="hog_visualize">HOG ‚Äî visualize</option>
          <option value="sift_features">SIFT Feature Detection</option>

        </optgroup>
      </select>

      <div id="params" class="params-panel">
        <!-- dynamic params will be injected here -->
      </div>

      <button type="submit">üöÄ Process Image</button>
    </form>

    <div class="results">
      <div class="compare-container">
        <h2>üé® Before & After Comparison</h2>
        <div class="img-compare">
          <div class="img-wrapper">
            <img id="inputImage" src="#" alt="Original" class="hidden"/>
            <span class="img-label">Before</span>
          </div>
          <div class="img-wrapper">
            <img id="outputImage" src="#" alt="Processed"/>
            <span class="img-label">After</span>
          </div>
        </div>
      </div>

      <div class="metadata">
        <h2>üßæ Metadata</h2>
        <pre id="metaData"></pre>
      </div>
    </div>
  </div>

  <footer>
    <p>Created by <b>H√§rshit Bhalia</b> & <b>Aryan Chauhan</b> | Powered by OpenCV + Flask</p>
  </footer>

  <!-- JavaScript logic for Upload + Process + dynamic params -->
  <script>
    const form = document.getElementById("uploadForm");
    const operationSelect = document.getElementById("operation");
    const paramsPanel = document.getElementById("params");
    const outputImage = document.getElementById("outputImage");
    const inputImage = document.getElementById("inputImage");
    const metaData = document.getElementById("metaData");

    const paramTemplates = {
      
      dct_block: [
        {name: 'dct_block_size', label: 'Block size (8 recommended)', type: 'number', value: 8, min:2},
        {name: 'dct_keep', label: 'Keep first K zig-zag coefficients', type: 'number', value: 10, min:1}
      ],
      zigzag_dct: [
        {name: 'dct_block_size', label: 'Block size', type: 'number', value: 8, min:2},
        {name: 'dct_keep', label: 'Keep first K coefficients', type: 'number', value: 10, min:1}
      ],
      quantize_levels: [
        {name: 'quant_levels', label: 'Quantization levels', type: 'number', value: 8, min:2}
      ],
      color_compress_kmeans: [
        {name: 'color_k', label: 'K (colors)', type: 'number', value: 8, min:1}
      ],
      shift: [
        {name: 'shift_x', label: 'shift_x (pixels, +right)', type: 'number', value: 0},
        {name: 'shift_y', label: 'shift_y (pixels, +down)', type: 'number', value: 0}
      ],
      hog_visualize: [
        {name: 'hog_ppc', label: 'pixels_per_cell', type: 'number', value: 8, min:1},
        {name: 'hog_cpb', label: 'cells_per_block', type: 'number', value: 2, min:1},
        {name: 'hog_orient', label: 'orientations', type: 'number', value: 9, min:1}
      ],
    
      rle_text: [],
      huffman_encoded_image: []
    };

    function clearParams() {
      paramsPanel.innerHTML = '';
    }

    function renderParamsFor(op) {
      clearParams();
      const templ = paramTemplates[op];
      if (!templ) return;
      templ.forEach(p => {
        const wrapper = document.createElement('div');
        wrapper.className = 'param-row';
        const label = document.createElement('label');
        label.innerText = p.label;
        label.htmlFor = p.name;
        const input = document.createElement('input');
        input.type = p.type;
        input.name = p.name;
        input.id = p.name;
        input.value = p.value;
        if (p.min !== undefined) input.min = p.min;
        wrapper.appendChild(label);
        wrapper.appendChild(input);
        paramsPanel.appendChild(wrapper);
      });
    }


    operationSelect.addEventListener('change', (e) => {
      renderParamsFor(e.target.value);
    });
    renderParamsFor(operationSelect.value);

   
    const fileInput = document.querySelector('input[name="file"]');
    fileInput.addEventListener('change', (ev) => {
      const file = ev.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        inputImage.src = e.target.result;
        inputImage.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const file = formData.get("file");
      if (!file || file.size === 0) {
        alert("Please select an image file.");
        return;
      }

      // ensure we pick up dynamic params (already inserted into DOM)
      // send formData directly
      try {
        const res = await fetch("/api/process", { method: "POST", body: formData });
        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (err) {
          alert("Server returned non-JSON response:\n" + text);
          return;
        }

        if (data.error) {
          alert("‚ùå Error: " + (data.error || 'Unknown'));
          console.error(data);
          return;
        }

        if (data.image_base64) {
          outputImage.src = "data:image/png;base64," + data.image_base64;
        }
        metaData.textContent = JSON.stringify(data.meta || {}, null, 2);
      } catch (error) {
        alert("Network error: " + error.message);
      }
    });
  </script>
</body>
</html>
